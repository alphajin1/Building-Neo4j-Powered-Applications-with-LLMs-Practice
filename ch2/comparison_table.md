# vector_similarity_search.py vs passage_retrieval.py ë¹„êµí‘œ

| êµ¬ë¶„ | vector_similarity_search.py | passage_retrieval.py |
|------|---------------------------|---------------------|
| **ì‚¬ìš© ëª¨ë¸** | â€¢ DPR Question Encoder<br>â€¢ DPR Context Encoder | â€¢ DPR Question Encoder<br>â€¢ DPR Context Encoder<br>â€¢ **DPR Reader** â­ |
| **ì²˜ë¦¬ ë‹¨ê³„** | 1ë‹¨ê³„: ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ë§Œ | 2ë‹¨ê³„: ë²¡í„° ê²€ìƒ‰ + Reader ê²€ì¦ |
| **ì£¼ìš” ê¸°ëŠ¥** | â€¢ ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±<br>â€¢ ë¬¸ì„œ ì„ë² ë”© ìƒì„±<br>â€¢ ìœ ì‚¬ë„ ì ìˆ˜ ê³„ì‚°<br>â€¢ ë¬¸ì„œ ìˆœìœ„ ë§¤ê¹€ | â€¢ ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±<br>â€¢ ë¬¸ì„œ ì„ë² ë”© ìƒì„±<br>â€¢ ìœ ì‚¬ë„ ì ìˆ˜ ê³„ì‚°<br>â€¢ ë¬¸ì„œ ìˆœìœ„ ë§¤ê¹€<br>â€¢ **Readerë¡œ ìµœì¢… passage ì„ íƒ** â­ |
| **ì¶œë ¥ ê²°ê³¼** | ëª¨ë“  ë¬¸ì„œì˜ ìˆœìœ„ì™€ ì ìˆ˜ | ìˆœìœ„ + **ê°€ì¥ ê´€ë ¨ì„± ë†’ì€ ë‹¨ì¼ passage** |
| **ë¬¸ì„œ ê°œìˆ˜** | 12ê°œ (ë‹¤ì–‘í•œ ê´€ë ¨ì„± í…ŒìŠ¤íŠ¸) | 5ê°œ (ëª¨ë‘ íƒœì–‘ ì—ë„ˆì§€ ê´€ë ¨) |
| **ì½”ë“œ ë¼ì¸ ìˆ˜** | 53ì¤„ | 80ì¤„ |
| **ì‚¬ìš© ëª©ì ** | ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ì˜ ê¸°ë³¸ ì›ë¦¬ í•™ìŠµ | DPR ì „ì²´ íŒŒì´í”„ë¼ì¸ (Retriever + Reader) í•™ìŠµ |

## DPR Readerë€?

### ğŸ“– ê°œë…
**DPR Reader**ëŠ” Dense Passage Retrieval (DPR) ì‹œìŠ¤í…œì˜ ë‘ ë²ˆì§¸ ë‹¨ê³„ë¡œ, **ê²€ìƒ‰ëœ passageë“¤ ì¤‘ì—ì„œ ì‹¤ì œë¡œ ì§ˆë¬¸ì— ë‹µí•  ìˆ˜ ìˆëŠ” ê°€ì¥ ê´€ë ¨ì„± ë†’ì€ passageë¥¼ ì„ íƒ**í•˜ëŠ” ëª¨ë¸ì…ë‹ˆë‹¤.

### ğŸ”„ DPR ì‹œìŠ¤í…œì˜ 2ë‹¨ê³„ êµ¬ì¡°

```
1ë‹¨ê³„: Retriever (ê²€ìƒ‰ê¸°)
   â””â”€ Question Encoder + Context Encoder
   â””â”€ ë²¡í„° ìœ ì‚¬ë„ë¡œ ê´€ë ¨ ë¬¸ì„œ í›„ë³´ë“¤ì„ ì°¾ìŒ

2ë‹¨ê³„: Reader (íŒë…ê¸°) â­
   â””â”€ DPR Reader
   â””â”€ í›„ë³´ ë¬¸ì„œë“¤ì„ ë” ì •ë°€í•˜ê²Œ ë¶„ì„í•˜ì—¬ ìµœì¢… ë‹µë³€ ê°€ëŠ¥í•œ passage ì„ íƒ
```

### ğŸ¯ Readerì˜ ì—­í• 

1. **ì •ë°€ ê²€ì¦**: Retrieverê°€ ì°¾ì€ ì—¬ëŸ¬ passageë“¤ì„ ì§ˆë¬¸ê³¼ í•¨ê»˜ ë¶„ì„
2. **ê´€ë ¨ì„± ì¬í‰ê°€**: ë‹¨ìˆœ ë²¡í„° ìœ ì‚¬ë„ê°€ ì•„ë‹Œ, ì‹¤ì œ ë‹µë³€ ê°€ëŠ¥ì„±ì„ í‰ê°€
3. **ìµœì  passage ì„ íƒ**: `relevance_logits`ë¥¼ í†µí•´ ê°€ì¥ ì í•©í•œ passage ì„ íƒ

### ğŸ’¡ ì™œ Readerê°€ í•„ìš”í•œê°€?

- **Retrieverì˜ í•œê³„**: ë²¡í„° ìœ ì‚¬ë„ëŠ” ë¹ ë¥´ì§€ë§Œ ë•Œë¡œëŠ” ë¶€ì •í™•í•  ìˆ˜ ìˆìŒ
- **Readerì˜ ì¥ì **: ì§ˆë¬¸ê³¼ passageë¥¼ í•¨ê»˜ ë¶„ì„í•˜ì—¬ ë” ì •í™•í•œ íŒë‹¨ ê°€ëŠ¥
- **ì •í™•ë„ í–¥ìƒ**: 2ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²°ê³¼ ì œê³µ

### ğŸ“Š ì½”ë“œì—ì„œì˜ ë™ì‘

```python
# passage_retrieval.pyì˜ Reader ì‚¬ìš© ë¶€ë¶„
inputs = reader_tokenizer(
    questions=query,                    # ì§ˆë¬¸
    titles=["Passage"] * len(passages), # passage ì œëª©ë“¤
    texts=passages,                     # ê²€ìƒ‰ëœ passageë“¤
    return_tensors="pt",
    padding=True,
    truncation=True
)

outputs = reader(**inputs)
# outputs.relevance_logits: ê° passageì˜ ê´€ë ¨ì„± ì ìˆ˜

max_score_index = torch.argmax(outputs.relevance_logits)
most_relevant_passage = passages[max_score_index]
# ê°€ì¥ ë†’ì€ ì ìˆ˜ë¥¼ ë°›ì€ passageê°€ ìµœì¢… ì„ íƒë¨
```

### ğŸ” ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

- **Retriever (Question/Context Encoder)**: ë„ì„œê´€ì—ì„œ ê´€ë ¨ ì±…ë“¤ì„ ì°¾ëŠ” ì‚¬ì„œ
- **Reader**: ì°¾ì€ ì±…ë“¤ì„ ì½ê³  ì§ˆë¬¸ì— ê°€ì¥ ì˜ ë‹µí•˜ëŠ” ì±…ì„ ì„ íƒí•˜ëŠ” ì „ë¬¸ê°€

